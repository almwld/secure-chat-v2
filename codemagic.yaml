workflows:
  android-release:
    name: Secure Chat Final Fix
    instance_type: mac_mini_m2
    scripts:
      - name: Project Reset and Setup
        script: |
          # تنظيف أي مخلفات بناء سابقة
          flutter clean
          
          # إنشاء مجلد أندرويد
          flutter create --platforms android --org com.cardiachat --project-name secure_chat_app .
          
          # حقن الصلاحيات
          sed -i '' 's|<manifest|<manifest xmlns:android="http://schemas.android.com/apk/res/android"> \n    <uses-permission android:name="android.permission.INTERNET"/>|' android/app/src/main/AndroidManifest.xml
          
          # تثبيت المكتبات وتوليد الأيقونة
          flutter pub get
          dart run flutter_launcher_icons
          
      - name: Build APK
        script: |
          flutter build apk --release --tree-shake-icons
    artifacts:
      - build/app/outputs/flutter-apk/*.apk
